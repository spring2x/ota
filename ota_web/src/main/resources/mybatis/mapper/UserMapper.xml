<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.iot.ota_web.mapper.UserMapper">
	
	<resultMap type="user" id="userMap">
		<id column="id" property="userId"/>
		<result column="name" property="name"/>
		<result column="password" property="password"/>
		<result column="lastLogin" property="lastLogin"/>
		<result column="user_token_id" property="userTokenId"/>
	</resultMap>
	
	<insert id="addUser" parameterType="user">
		<selectKey resultType="int" order="AFTER" keyProperty="userId">
          SELECT LAST_INSERT_ID()
     	</selectKey>
		insert into user(name,password) values(#{name},#{password})
	</insert>
	
	<select id="getUsers" parameterType="com.alibaba.fastjson.JSONObject" resultMap="userMap">
		select 
			* 
		from 
			user
	</select>
	
	<select id="existUser" parameterType="user" resultMap="userMap">
		select 
			* 
		from 
			user
		where
			name=#{name}
	</select>
	
	<select id="checkUser" parameterType="user" resultMap="userMap">
		select 
			* 
		from 
			user
		where
			name=#{name} and password=#{password}
	</select>
	
	<update id="updateUser" parameterType="user">
		update
			user
		set
			<if test="userTokenId != null">
				user_token_id=#{userTokenId}
			</if>
		where
			name=#{name}
	</update>
	
	<update id="cleanUserToken" parameterType="com.alibaba.fastjson.JSONObject">
		update
			user
		set
			user_token_id=null
		where
			user_token_id=(select id from token where uuid=#{token})
	</update>
</mapper>